@page "/teachers/create"
@inject SMS.CimContext DB
@using SMS.Models
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Create</PageTitle>

<h1>Create</h1>

<h4>创建教师</h4>
<AntDesign.Divider />
<AntDesign.Row>
    <AntDesign.Col Span="12">
        <AntDesign.Card Title="新建教师信息">
            <EditForm method="post" Model="Teacher" OnValidSubmit="AddTeacher" FormName="create" Enhance>
                <DataAnnotationsValidator />
                <ValidationSummary style="color: #ff4d4f;" />
                
                <AntDesign.Form Model="@Teacher" Layout="@AntDesign.FormLayout.Vertical">
                    <ChildContent Context="formContext">
                        <AntDesign.FormItem Label="教师号(TID):">
                            <Microsoft.AspNetCore.Components.Forms.InputNumber @bind-Value="Teacher.TID" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Teacher.TID" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem Label="姓名:">
                            <InputText @bind-Value="Teacher.Name" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Teacher.Name" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem Label="年龄:">
                            <Microsoft.AspNetCore.Components.Forms.InputNumber @bind-Value="Teacher.Age" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Teacher.Age" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem Label="专业:">
                            <InputText @bind-Value="Teacher.Major" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Teacher.Major" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem Label="邮箱:">
                            <InputText @bind-Value="Teacher.Email" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Teacher.Email" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem>
                            <AntDesign.Button Type="@AntDesign.ButtonType.Primary" HtmlType="submit">创建</AntDesign.Button>
                            <AntDesign.Button style="margin-left: 8px;" @onclick="@(() => NavigationManager.NavigateTo("/teachers"))">取消</AntDesign.Button>
                        </AntDesign.FormItem>
                    </ChildContent>
                </AntDesign.Form>
            </EditForm>
        </AntDesign.Card>
    </AntDesign.Col>
</AntDesign.Row>

<div style="margin-top: 16px;">
    <AntDesign.Button @onclick="@(() => NavigationManager.NavigateTo("/teachers"))">返回列表</AntDesign.Button>
</div>

@code {

    [Inject]
    public IJSRuntime JSRuntime { get; set; } = default!;
    private string currentUser = string.Empty;

    [SupplyParameterFromForm]
    public Teacher Teacher { get; set; } = new();

    // To protect from overposting attacks, see https://aka.ms/RazorPagesCRUD
    public async Task AddTeacher()
    {
        currentUser = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "currentUser") ?? string.Empty;
        if (!string.IsNullOrEmpty(currentUser))
        {
            Teacher.CreateUser = currentUser;
            Teacher.UpdateUser = currentUser;
        }
        DB.SMS_Teachers.Add(Teacher);
        await DB.SaveChangesAsync();
        NavigationManager.NavigateTo("/teachers");
    }
}
