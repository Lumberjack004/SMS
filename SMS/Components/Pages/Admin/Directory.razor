@page "/admin-directory"
@using AntDesign
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer

<PageTitle>管理员目录 - SMS平台</PageTitle>

<div style="padding: 40px; background: #f0f2f5; min-height: 100vh;">
    <div style="text-align: center; margin-bottom: 50px;">
        <h1 style="color: #1890ff; font-size: 2.5rem; margin-bottom: 16px;">学生管理系统</h1>
    </div>
    
    <!-- 核心管理功能 -->
    <div style="margin-bottom: 60px;">
        <h2 style="text-align: center; color: #333; margin-bottom: 30px;"><Icon Type="bar-chart" style="margin-right: 8px;" />核心管理功能</h2>
        <Row Gutter="24" style="max-width: 1200px; margin: 0 auto;">
            <Col Xs="24" Sm="12" Md="6">
                <Card Hoverable="true" style="margin-bottom: 24px; text-align: center; border-radius: 12px;">
                    <Body>
                        <a href="/admin-students" style="text-decoration: none; color: inherit;">
                            <div style="padding: 20px;">
                                <Icon Type="idcard" Theme="@IconThemeType.Outline" style="font-size: 3rem; color: #1890ff; margin-bottom: 16px;" />
                                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <div @onclick="@((e) => ToggleFavorite("students"))" @onclick:preventDefault="true" @onclick:stopPropagation="true"
                                         style="cursor: pointer; transition: color 0.3s ease;"
                                         title="@(favorites.Contains("students") ? "取消收藏" : "添加收藏")">
                                        @if (favorites.Contains("students"))
                                        {
                                            <span style="color: #ffd700; font-size: 1.5rem;">★</span>
                                        }
                                        else
                                        {
                                            <span style="color: #d9d9d9; font-size: 1.5rem;">☆</span>
                                        }
                                    </div>
                                    <h3 style="margin: 0; color: #333;">学生管理</h3>
                                </div>
                            </div>
                        </a>
                    </Body>
                </Card>
            </Col>
            
            <Col Xs="24" Sm="12" Md="6">
                <Card Hoverable="true" style="margin-bottom: 24px; text-align: center; border-radius: 12px;">
                    <Body>
                        <a href="/admin-teachers" style="text-decoration: none; color: inherit;">
                            <div style="padding: 20px;">
                                <Icon Type="read" Theme="@IconThemeType.Outline" style="font-size: 3rem; color: #52c41a; margin-bottom: 16px;" />
                                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <div @onclick="@((e) => ToggleFavorite("teachers"))" @onclick:preventDefault="true" @onclick:stopPropagation="true"
                                         style="cursor: pointer; transition: color 0.3s ease;"
                                         title="@(favorites.Contains("teachers") ? "取消收藏" : "添加收藏")">
                                        @if (favorites.Contains("teachers"))
                                        {
                                            <span style="color: #ffd700; font-size: 1.5rem;">★</span>
                                        }
                                        else
                                        {
                                            <span style="color: #d9d9d9; font-size: 1.5rem;">☆</span>
                                        }
                                    </div>
                                    <h3 style="margin: 0; color: #333;">教师管理</h3>
                                </div>
                            </div>
                        </a>
                    </Body>
                </Card>
            </Col>
            
            <Col Xs="24" Sm="12" Md="6">
                <Card Hoverable="true" style="margin-bottom: 24px; text-align: center; border-radius: 12px;">
                    <Body>
                        <a href="/admin-courses" style="text-decoration: none; color: inherit;">
                            <div style="padding: 20px;">
                                <Icon Type="book" Theme="@IconThemeType.Outline" style="font-size: 3rem; color: #fa8c16; margin-bottom: 16px;" />
                                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <div @onclick="@((e) => ToggleFavorite("courses"))" @onclick:preventDefault="true" @onclick:stopPropagation="true"
                                         style="cursor: pointer; transition: color 0.3s ease;"
                                         title="@(favorites.Contains("courses") ? "取消收藏" : "添加收藏")">
                                        @if (favorites.Contains("courses"))
                                        {
                                            <span style="color: #ffd700; font-size: 1.5rem;">★</span>
                                        }
                                        else
                                        {
                                            <span style="color: #d9d9d9; font-size: 1.5rem;">☆</span>
                                        }
                                    </div>
                                    <h3 style="margin: 0; color: #333;">课程管理</h3>
                                </div>
                            </div>
                        </a>
                    </Body>
                </Card>
            </Col>
            
            <Col Xs="24" Sm="12" Md="6">
                <Card Hoverable="true" style="margin-bottom: 24px; text-align: center; border-radius: 12px;">
                    <Body>
                        <a href="/admin-enrollment-management" style="text-decoration: none; color: inherit;">
                            <div style="padding: 20px;">
                                <Icon Type="team" Theme="@IconThemeType.Outline" style="font-size: 3rem; color: #eb2f96; margin-bottom: 16px;" />
                                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <div @onclick="@((e) => ToggleFavorite("enrollments"))" @onclick:preventDefault="true" @onclick:stopPropagation="true"
                                         style="cursor: pointer; transition: color 0.3s ease;"
                                         title="@(favorites.Contains("enrollments") ? "取消收藏" : "添加收藏")">
                                        @if (favorites.Contains("enrollments"))
                                        {
                                            <span style="color: #ffd700; font-size: 1.5rem;">★</span>
                                        }
                                        else
                                        {
                                            <span style="color: #d9d9d9; font-size: 1.5rem;">☆</span>
                                        }
                                    </div>
                                    <h3 style="margin: 0; color: #333;">选课管理</h3>
                                </div>
                            </div>
                        </a>
                    </Body>
                </Card>
            </Col>
        </Row>
    </div>
    
    <!-- Web API 专用功能 -->
    <div style="margin-bottom: 60px;">
        <h2 style="text-align: center; color: #333; margin-bottom: 30px;"><Icon Type="rocket" style="margin-right: 8px;" /> Web API 专用功能</h2>
        <Row Gutter="24" style="max-width: 1200px; margin: 0 auto;">
            <Col Xs="24" Sm="12" Md="8">
                <Card style="margin-bottom: 24px; border-radius: 12px; border-left: 4px solid #1890ff;">
                    <Body>
                        <a href="/swagger" target="_blank" style="text-decoration: none; color: inherit;">
                            <div style="padding: 16px;">
                                <Icon Type="api" style="font-size: 2rem; color: #1890ff; margin-bottom: 12px;" />
                                <h4 style="margin: 0; color: #333;">API 文档 (Swagger)</h4>
                            </div>
                        </a>
                    </Body>
                </Card>
            </Col>
            
            <Col Xs="24" Sm="12" Md="8">
                <Card style="margin-bottom: 24px; border-radius: 12px; border-left: 4px solid #52c41a;">
                    <Body>
                        <div style="padding: 16px;">
                            <Icon Type="download" style="font-size: 2rem; color: #52c41a; margin-bottom: 12px;" />
                            <h4 style="margin: 0; color: #333;">数据导出</h4>
                            <div style="margin-top: 12px;">
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <a href="/api/Export/students" target="_blank" style="color: #1890ff; text-decoration: none;"><Icon Type="download" style="margin-right: 6px;" />导出学生数据</a>
                                    <a href="/api/Export/teachers" target="_blank" style="color: #1890ff; text-decoration: none;"><Icon Type="download" style="margin-right: 6px;" />导出教师数据</a>
                                    <a href="/api/Export/courses" target="_blank" style="color: #1890ff; text-decoration: none;"><Icon Type="download" style="margin-right: 6px;" />导出课程数据</a>
                                    <a href="/api/Export/enrollments" target="_blank" style="color: #1890ff; text-decoration: none;"><Icon Type="download" style="margin-right: 6px;" />导出选课数据</a>
                                </div>
                            </div>
                        </div>
                    </Body>
                </Card>
            </Col>
        </Row>
    </div>
    
</div>

<style>
    .ant-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        transition: all 0.3s ease;
    }
    
    .ant-card-body a:hover h3,
    .ant-card-body a:hover h4 {
        color: #1890ff !important;
        transition: color 0.3s ease;
    }
    
    .ant-tag {
        margin: 2px;
        border-radius: 4px;
    }
    
    .ant-space-item a:hover {
        text-decoration: underline;
    }
</style>

@code {
    private List<string> favorites = new List<string>();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await LoadFavorites();
            StateHasChanged();
        }
    }

    private async Task LoadFavorites()
    {
        try
        {
            var favoritesJson = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "favorites");
            if (!string.IsNullOrEmpty(favoritesJson) && favoritesJson != "null" && favoritesJson != "undefined")
            {
                favorites = System.Text.Json.JsonSerializer.Deserialize<List<string>>(favoritesJson) ?? new List<string>();
            }
            else
            {
                favorites = new List<string>();
            }
        }
        catch
        {
            favorites = new List<string>();
        }
    }

    private async Task ToggleFavorite(string item)
    {
        if (favorites.Contains(item))
        {
            favorites.Remove(item);
        }
        else
        {
            favorites.Add(item);
        }

        var favoritesJson = System.Text.Json.JsonSerializer.Serialize(favorites);
        await JSRuntime.InvokeVoidAsync("localStorage.setItem", "favorites", favoritesJson);
        
        // 触发存储事件以更新其他页面
        await JSRuntime.InvokeVoidAsync("eval", $@"
            window.dispatchEvent(new StorageEvent('storage', {{
                key: 'favorites',
                newValue: '{favoritesJson}'
            }}));
        ");
        
        StateHasChanged();
    }
}
