@page "/students/create"
@inject SMS.CimContext DB
@using SMS.Models
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Create</PageTitle>

<h1>Create</h1>

<h4>创建学生</h4>
<AntDesign.Divider />
<AntDesign.Row>
    <AntDesign.Col Span="12">
        <AntDesign.Card Title="新建学生信息">
            <EditForm method="post" Model="Student" OnValidSubmit="AddStudent" FormName="create" Enhance>
                <DataAnnotationsValidator />
                <ValidationSummary style="color: #ff4d4f;" />
                
                <AntDesign.Form Model="@Student" Layout="@AntDesign.FormLayout.Vertical">
                    <ChildContent Context="formContext">
                        <AntDesign.FormItem Label="学号(SID):">
                            <Microsoft.AspNetCore.Components.Forms.InputNumber @bind-Value="Student.SID" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Student.SID" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem Label="姓名:">
                            <InputText @bind-Value="Student.Name" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Student.Name" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem Label="年龄:">
                            <Microsoft.AspNetCore.Components.Forms.InputNumber @bind-Value="Student.Age" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Student.Age" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem Label="专业:">
                            <InputText @bind-Value="Student.Major" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Student.Major" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem Label="邮箱:">
                            <InputText @bind-Value="Student.Email" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px;" />
                            <ValidationMessage For="() => Student.Email" style="color: #ff4d4f;" />
                        </AntDesign.FormItem>
                        
                        <AntDesign.FormItem>
                            <AntDesign.Button Type="@AntDesign.ButtonType.Primary" HtmlType="submit">创建</AntDesign.Button>
                            <AntDesign.Button style="margin-left: 8px;" @onclick="@(() => NavigationManager.NavigateTo("/students"))">取消</AntDesign.Button>
                        </AntDesign.FormItem>
                    </ChildContent>
                </AntDesign.Form>
            </EditForm>
        </AntDesign.Card>
    </AntDesign.Col>
</AntDesign.Row>

<div style="margin-top: 16px;">
    <AntDesign.Button @onclick="@(() => NavigationManager.NavigateTo("/students"))">返回列表</AntDesign.Button>
</div>

@code {

    [Inject]
    public IJSRuntime JSRuntime { get; set; } = default!;
    private string currentUser = string.Empty;

    [SupplyParameterFromForm]
    public Student Student { get; set; } = new();

    // To protect from overposting attacks, see https://aka.ms/RazorPagesCRUD
    public async Task AddStudent()
    {
        currentUser = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "currentUser") ?? string.Empty;
        if (!string.IsNullOrEmpty(currentUser))
        {
            Student.CreateUser = currentUser;
            Student.UpdateUser = currentUser;
        }
        DB.SMS_Students.Add(Student);
        await DB.SaveChangesAsync();
        NavigationManager.NavigateTo("/students");
    }
}
